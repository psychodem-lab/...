<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Instrument Studio</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #007bff; --success: #28a745; --bg: #f4f7f9; --card-bg: #ffffff;
            --text: #333; --border: #dee2e6; --danger: #dc3545; --guitar-wood: #3d2b1f;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 10px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 1100px; background: var(--card-bg); padding: 20px; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        
        .display-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .inst-display { background: #222; color: var(--primary); padding: 15px; border-radius: 10px; text-align: center; font-weight: bold; font-size: 1.2em; border: 2px solid #444; }
        .inst-display span { color: #fff; display: block; font-size: 0.7em; text-transform: uppercase; margin-bottom: 5px; opacity: 0.7; }
        
        /* TEXTAREAS */
        .editor-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        textarea { width: 100%; height: 120px; padding: 10px; border-radius: 8px; border: 1px solid var(--border); font-family: monospace; resize: none; box-sizing: border-box; }

        /* PIANO */
        .piano-wrap { overflow-x: auto; white-space: nowrap; padding: 10px 0; text-align: center; }
        .octave { display: inline-block; position: relative; height: 100px; }
        .white-key, .black-key { display: inline-block; border: 1px solid #888; cursor: pointer; float: left; border-radius: 0 0 4px 4px; font-size: 9px; align-items: flex-end; display: flex; justify-content: center; padding-bottom: 2px; }
        .white-key { width: 30px; height: 100px; background: white; }
        .black-key { width: 20px; height: 60px; background: #222; margin: 0 -10px; z-index: 2; color: #eee; }
        .piano-active { background: var(--primary) !important; color: white !important; }

        /* GUITAR */
        .guitar-wrap { text-align: center; margin-top: 10px; }
        .guitar-neck { display: inline-block; background: var(--guitar-wood); border: 2px solid #222; border-radius: 4px; padding: 5px 0; overflow-x: auto; max-width: 100%; }
        .string { height: 26px; display: flex; align-items: center; position: relative; }
        .string::before { content: ""; position: absolute; width: 100%; height: 2px; background: #999; z-index: 1; }
        .fret { width: 55px; height: 100%; border-right: 2px solid #c0c0c0; display: flex; justify-content: center; align-items: center; cursor: pointer; z-index: 2; position: relative; }
        .fret-0 { width: 35px; border-right: 5px solid #e5c100; background: rgba(0,0,0,0.4); }
        .note-dot { width: 18px; height: 18px; border-radius: 50%; background: transparent; color: transparent; font-size: 10px; display: flex; justify-content: center; align-items: center; }
        .guitar-active .note-dot { background: var(--success) !important; color: white !important; box-shadow: 0 0 8px var(--success); }

        .label { font-weight: bold; color: #666; font-size: 12px; margin: 15px 0 5px; text-transform: uppercase; text-align: center; }
        .btn-clear { padding: 5px 10px; font-size: 11px; cursor: pointer; margin-top: 5px; }
    </style>
</head>
<body>

<div class="container">
    <div class="display-row">
        <div class="inst-display"><span>Akord Pianino</span><div id="piano-res">---</div><button class="btn-clear" onclick="clearPiano()">Reset</button></div>
        <div class="inst-display"><span>Akord Gitara</span><div id="guitar-res">---</div><button class="btn-clear" onclick="clearGuitar()">Reset</button></div>
    </div>

    <div class="editor-grid">
        <textarea id="inp" placeholder="Tekst piosenki..." oninput="sync()"></textarea>
        <textarea id="out" readonly placeholder="Wynik transpozycji..."></textarea>
    </div>

    <div class="label">Pianino (Kliknij do 4 klawiszy)</div>
    <div class="piano-wrap"><div id="piano-body"></div></div>

    <div class="label">Gitara (Standard E)</div>
    <div class="guitar-wrap"><div class="guitar-neck" id="guitar-body"></div></div>
</div>

<script>
    const SCALE = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
    const CHORDS = { '': [0,4,7], 'm': [0,3,7], '7': [0,4,7,10], 'maj7': [0,4,7,11], 'm7': [0,3,7,10], 'sus4': [0,5,7], 'sus2': [0,2,7], 'dim': [0,3,6], 'aug': [0,4,8], '6': [0,4,7,9] };

    let pianoNotes = [];
    let guitarNotes = [];

    function init() {
        // Build Piano
        const pb = document.getElementById('piano-body');
        const pat = [1,0,1,0,1,1,0,1,0,1,0,1];
        for(let o=2; o<=4; o++) {
            const oct = document.createElement('div'); oct.className = 'octave';
            SCALE.forEach((n, i) => {
                const k = document.createElement('div');
                k.className = pat[i] ? 'white-key' : 'black-key';
                k.dataset.note = n; k.textContent = n;
                k.onclick = () => {
                    if(k.classList.contains('piano-active')) {
                        k.classList.remove('piano-active');
                    } else if(document.querySelectorAll('.piano-active').length < 4) {
                        k.classList.add('piano-active');
                    }
                    analyze('piano');
                };
                oct.appendChild(k);
            });
            pb.appendChild(oct);
        }

        // Build Guitar
        const gb = document.getElementById('guitar-body');
        ['E4','B3','G3','D3','A2','E2'].forEach((root, sIdx) => {
            const str = document.createElement('div'); str.className = 'string';
            let rIdx = SCALE.indexOf(root.replace(/\d/,''));
            for(let f=0; f<=12; f++) {
                const fret = document.createElement('div');
                fret.className = `fret fret-${f}`;
                let nIdx = (rIdx + f) % 12;
                fret.dataset.note = SCALE[nIdx];
                fret.innerHTML = `<div class="note-dot">${SCALE[nIdx]}</div>`;
                fret.onclick = () => {
                    const was = fret.classList.contains('guitar-active');
                    str.querySelectorAll('.fret').forEach(el => el.classList.remove('guitar-active'));
                    if(!was) fret.classList.add('guitar-active');
                    analyze('guitar');
                };
                str.appendChild(fret);
            }
            gb.appendChild(str);
        });
    }

    function analyze(inst) {
        const active = document.querySelectorAll(`.${inst}-active`);
        const resDisp = document.getElementById(`${inst}-res`);
        
        if(!active.length) { resDisp.textContent = "---"; return; }
        
        let notes = [...new Set(Array.from(active).map(el => SCALE.indexOf(el.dataset.note)))].sort((a,b)=>a-b);
        
        if(notes.length === 1) { resDisp.textContent = SCALE[notes[0]]; return; }

        for(let root of notes) {
            let intervals = notes.map(n => (n - root + 12) % 12).sort((a,b)=>a-b);
            for(let name in CHORDS) {
                if(intervals.length === CHORDS[name].length && intervals.every((v,i) => v === CHORDS[name][i])) {
                    resDisp.textContent = SCALE[root] + name;
                    return;
                }
            }
        }
        resDisp.textContent = "???";
    }

    function clearPiano() { document.querySelectorAll('.piano-active').forEach(el => el.classList.remove('piano-active')); analyze('piano'); }
    function clearGuitar() { document.querySelectorAll('.guitar-active').forEach(el => el.classList.remove('guitar-active')); analyze('guitar'); }
    function sync() { document.getElementById('out').value = document.getElementById('inp').value; }

    window.onload = init;
</script>
</body>
</html>
