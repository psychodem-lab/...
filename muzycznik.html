<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piosenki i Akordy - Lista i Transpozycja</title>
    <style>
        /* --- CSS: Stylizacja --- */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            display: flex; /* U≈ºywamy Flexboxa do uk≈Çadu Lista + Piosenka */
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        
        /* Styl dla listy piosenek */
        #song-list-container {
            width: 250px;
            padding-right: 20px;
            border-right: 1px solid #ddd;
            flex-shrink: 0; /* Nie kurczy siƒô */
        }

        #song-list-container h2 {
            color: #007bff;
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #007bff;
        }

        #song-list li {
            list-style: none;
            padding: 8px 0;
            cursor: pointer;
            font-size: 1.1em;
            transition: background-color 0.2s;
            border-bottom: 1px dotted #eee;
        }

        #song-list li:hover {
            background-color: #f0f0f0;
        }

        #song-list li.active {
            font-weight: bold;
            color: #d9534f; /* Kolor dla aktualnie wybranej piosenki */
        }
        
        /* Styl dla obszaru piosenki */
        #song-content {
            flex-grow: 1; /* Zajmuje resztƒô miejsca */
            padding-left: 20px;
        }

        /* Elementy piosenki (jak w poprzedniej wersji) */
        .song-title {
            font-size: 2em;
            margin-top: 0;
        }
        .song-artist {
            font-style: italic;
            margin-bottom: 20px;
            display: block;
        }
        .controls {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        /* ... reszta styl√≥w dla akord√≥w, przycisk√≥w i linii piosenki bez zmian ... */
        .controls button {
            padding: 8px 15px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            margin: 0 5px;
            transition: background-color 0.3s;
        }

        #transpose-up {
            background-color: #28a745;
            color: white;
        }

        #transpose-down {
            background-color: #dc3545;
            color: white;
        }
        .akord {
            color: #007bff; 
            font-weight: bold;
            display: inline-block;
            white-space: pre; 
            margin-bottom: -5px; 
            margin-top: 5px;
        }
        
        .piosenka-linia {
            margin-top: 10px;
            line-height: 1.5;
        }
        .stanza {
            margin-bottom: 20px;
            border-left: 3px solid #ccc;
            padding-left: 10px;
        }


    </style>
</head>
<body>

    <div class="container">
        
        <div id="song-list-container">
            <h2>üéµ Lista Piosenek</h2>
            <ul id="song-list">
                <li>≈Åadowanie...</li>
            </ul>
        </div>

        <div id="song-content">
            <h1 class="song-title" id="song-title">Wybierz piosenkƒô</h1>
            <span class="song-artist" id="song-artist"></span>
            
            <div class="controls">
                <label>Aktualna Tonacja: <span id="current-key">?</span></label>
                <div>
                    <button id="transpose-down" data-step="-1" disabled>‚ô≠ Ni≈ºej</button>
                    <button id="transpose-up" data-step="1" disabled>‚ôØ Wy≈ºej</button>
                </div>
            </div>

            <div id="piosenka">
                <p>Wybierz tytu≈Ç z listy po lewej, aby zobaczyƒá tekst i akordy.</p>
            </div>
        </div>

    </div>

    <script>
        // --- STA≈ÅE I ZMIENNE GLOBALNE ---
        const NOTES = [
            "C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"
        ];
        
        let originalChords = []; 
        let currentNoteIndex = 0;
        let allSongs = []; // Nowa zmienna do przechowywania wszystkich piosenek
        
        // --- FUNKCJE LOGICZNE (Transpozycja - bez zmian) ---
        function transposeChord(chord, steps) {
            let baseNote = chord;
            let modifiers = "";

            for (const note of NOTES) {
                if (chord.startsWith(note)) {
                    baseNote = note;
                    modifiers = chord.substring(note.length);
                    break;
                }
            }

            let noteIndex = NOTES.indexOf(baseNote);
            if (noteIndex === -1) { return chord; }

            let newIndex = (noteIndex + steps) % 12;
            if (newIndex < 0) { newIndex += 12; }

            return NOTES[newIndex] + modifiers;
        }

        function transposeSong(steps) {
            currentNoteIndex = (currentNoteIndex + steps) % 12;
            if (currentNoteIndex < 0) { currentNoteIndex += 12; }

            const currentKey = NOTES[currentNoteIndex];
            document.getElementById('current-key').textContent = currentKey;

            const akordElements = document.querySelectorAll('#piosenka .akord');
            
            akordElements.forEach((span, index) => {
                const originalChord = originalChords[index]; 
                const newChord = transposeChord(originalChord, currentNoteIndex);
                span.textContent = newChord + ' ';
            });
        }
        
        // --- RENDEROWANIE TRE≈öCI PIOSENKI (bez zmian) ---
        function renderSongContent(songData) {
            const piosenkaDiv = document.getElementById('piosenka');
            piosenkaDiv.innerHTML = ''; 
            originalChords = []; 

            document.getElementById('song-title').textContent = songData.title;
            document.getElementById('song-artist').textContent = songData.artist;

            songData.stanzas.forEach(stanza => {
                const stanzaDiv = document.createElement('div');
                stanzaDiv.className = 'stanza';

                stanza.lines.forEach(line => {
                    const lineDiv = document.createElement('div');
                    lineDiv.className = 'piosenka-linia';

                    const chords = line.chords.split(/\s+/).filter(c => c.length > 0);
                    let chordHTML = '';
                    
                    chords.forEach(chord => {
                        chordHTML += `<span class="akord">${chord}</span>`;
                        originalChords.push(chord); 
                    });
                    
                    lineDiv.innerHTML = chordHTML + '\n' + line.lyrics;
                    stanzaDiv.appendChild(lineDiv);
                });
                piosenkaDiv.appendChild(stanzaDiv);
            });
            
            // Inicjalizacja transpozycji dla nowej piosenki
            const originalKey = songData.originalKey || 'C';
            const initialIndex = NOTES.indexOf(originalKey.toUpperCase());
            currentNoteIndex = initialIndex !== -1 ? initialIndex : 0;
            transposeSong(0); 

            // W≈ÇƒÖczenie przycisk√≥w
            document.getElementById('transpose-up').disabled = false;
            document.getElementById('transpose-down').disabled = false;
        }

        // --- NOWA FUNKCJA: RENDEROWANIE LISTY PIOSENEK ---
        function renderSongList(songs) {
            const listUl = document.getElementById('song-list');
            listUl.innerHTML = ''; // Czy≈õcimy "≈Åadowanie..."

            songs.forEach((song, index) => {
                const listItem = document.createElement('li');
                listItem.textContent = song.title;
                listItem.setAttribute('data-index', index); // Zapisujemy indeks piosenki
                
                // Dodajemy nas≈Çuchiwanie klikniƒôcia
                listItem.addEventListener('click', () => {
                    // Wy≈ÇƒÖczamy klasƒô 'active' u wszystkich element√≥w
                    document.querySelectorAll('#song-list li').forEach(li => {
                        li.classList.remove('active');
                    });
                    // W≈ÇƒÖczamy klasƒô 'active' u klikniƒôtego elementu
                    listItem.classList.add('active');
                    
                    // ≈Åadujemy i renderujemy wybranƒÖ piosenkƒô
                    renderSongContent(allSongs[index]);
                });

                listUl.appendChild(listItem);
            });
            
            // Opcjonalnie: Za≈Çaduj pierwszƒÖ piosenkƒô po wczytaniu listy
            if (songs.length > 0) {
                listUl.firstChild.classList.add('active');
                renderSongContent(songs[0]);
            }
        }

        // --- G≈Å√ìWNA LOGIKA ≈ÅADOWANIA Z PLIKU JSON ---
        function loadSongsFromFile(filename = 'piosenki.json') {
            fetch(filename)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`B≈ÇƒÖd ≈Çadowania pliku ${filename}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(songs => {
                    if (songs.length > 0) {
                        allSongs = songs; // Zapisujemy wszystkie piosenki globalnie
                        renderSongList(allSongs); // Tworzymy listƒô
                    } else {
                        throw new Error('Plik JSON jest pusty lub nie zawiera piosenek.');
                    }
                })
                .catch(error => {
                    console.error('WystƒÖpi≈Ç b≈ÇƒÖd podczas ≈Çadowania danych:', error);
                    document.getElementById('song-title').textContent = 'B≈ÇƒÖd: Nie uda≈Ço siƒô wczytaƒá danych.';
                    document.getElementById('piosenka').innerHTML = '<p>Sprawd≈∫ konsolƒô, czy plik JSON jest poprawny i czy strona dzia≈Ça na serwerze.</p>';
                    document.getElementById('transpose-up').disabled = true;
                    document.getElementById('transpose-down').disabled = true;
                });
        }

        // --- START APLIKACJI ---
        loadSongsFromFile();

        // Dodanie s≈Çuchaczy zdarze≈Ñ do przycisk√≥w
        document.getElementById('transpose-up').addEventListener('click', () => {
            transposeSong(1); 
        });

        document.getElementById('transpose-down').addEventListener('click', () => {
            transposeSong(-1); 
        });

    </script>

</body>
</html>
